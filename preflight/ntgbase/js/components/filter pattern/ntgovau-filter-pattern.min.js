let totalItems=document.querySelectorAll("#pageContentItem").length,filters={},uniqueFilter={label:"Unique Pill",option:"",value:"",key:"uniquePill"};async function fetchData(){try{var e=await fetch(payloadUrl);if(!e.ok)throw new Error("Network response was not ok");populatePageContent(await e.json()),console.log("Data fetched successfully.")}catch(e){throw console.error("Error fetching data:",e),e}}function populatePageContent(e){var t=document.getElementById("pageContent"),l=sessionStorage.getItem("viewMode")||"grid";t.innerHTML="",toggleViewMode(l,t,e),filterContent(),console.log("populatePageContent - Total items: "+e.length)}function toggleViewMode(e,t,l){let n="grid"===e;document.getElementById("list-view").classList.toggle("ntg-active",!n),document.getElementById("grid-view").classList.toggle("ntg-active",n),l.forEach(e=>createPageContentItem(t,e,n)),console.log("View mode toggled to "+e)}function setViewMode(e){sessionStorage.setItem("viewMode",e),showThenHideSpinner(),fetchData(),console.log("View mode switched to "+e)}let listViewButton=document.getElementById("list-view"),gridViewButton=document.getElementById("grid-view");function toggleNoResultsMessage(e){var t=document.getElementById("noResults"),l=document.getElementById("listViewHeadings");t.style.display=e?"none":"block",$("#pageContent").toggle(e),l.style.display=e&&"list"==sessionStorage.getItem("viewMode")?"block":"none",console.log("No results message toggled, results found: "+e)}function extractOptions(e){let t=new Set;e.forEach(e=>{e.querySelectorAll("span.d-lg-none, span.d-md-none").forEach(e=>e.remove());e=e.textContent.trim().replace(/\n/g,"");t.add(e)});e=Array.from(t).sort().filter(e=>""!==e.trim());return console.log("Extracted menu options:",e),e}function setupDropdown(e,t,l){let n=document.getElementById(l);t=extractOptions(document.querySelectorAll(t));populateDropdown(n,t),n.addEventListener("change",function(){showThenHideSpinner(),createFilterPill(l,this.options[this.selectedIndex].text,this.value,e),n.selectedIndex=0}),filters[e]||(filters[e]=[])}function populateDropdown(l,e){var t=l.querySelector('option[value="all"]');l.innerHTML="",l.appendChild(t),e.forEach(e=>{var t=document.createElement("option");t.value=e.toLowerCase().replace(/\s+/g," "),t.textContent=e.trim(),l.appendChild(t)})}function evaluateFilters(l){var e=l.querySelector("[data-text]"),t=document.getElementById("textInput").value.toLowerCase().trim(),e=!t||e.textContent.trim().toLowerCase().includes(t),t=Object.keys(filters).every(e=>{let t=l.querySelector(`[data-${e.split("-")[0]}]`);return 0===filters[e].length||t&&filters[e].some(e=>t.textContent.trim().toLowerCase().includes(e.value.toLowerCase()))});return e&&t}function filterContent(){var e=document.querySelectorAll("#pageContentItem");let n=!1;e.forEach(e=>{var t=evaluateFilters(e),l=e.querySelector("#pageContentItemData");e.style.display=t?"":"none",e.classList.toggle("d-none",!t),l.classList.toggle("d-block",t),l.classList.toggle("d-none",!t),t&&(n=!0)}),currentPage=1,toggleNoResultsMessage(n),toggleFilterContainerVisibility(),renderCardItems(),console.log("Content filtered.")}function createFilterPill(e,t,l,n){var i,e={label:e,option:t,value:l,key:n,active:!0};"all"===l||filters[n].some(e=>e.value===l)||(filters[n].push(e),console.log("Filter added:",e),console.log("Current filters:",filters),filterContent(),e=document.getElementById("filterPills"),(i=document.createElement("div")).classList.add("ntg-pill"),i.innerHTML=`
            <div class="btn btn-outline-dark rounded-pill me-2 mb-1 p-0">
                <input class="ntg-pill__checkbox" type="checkbox" name="pill${l}" id="pill${l}" checked>
                <label class="ntg-pill--filter__label py-2 px-3" for="pill${l}">${t}</label>
            </div>
        `,i.addEventListener("click",function(){var e=filters[n].findIndex(e=>e.value===l);filters[n].splice(e,1),this.remove(),showThenHideSpinner(),filterContent(),console.log("Filter removed, here is the updated filters "+filters[n])}),e.appendChild(i),toggleFilterContainerVisibility())}function toggleFilterContainerVisibility(){var e=document.getElementById("active-filters"),t=Object.values(filters).some(e=>0<e.length),l=uniqueFilter&&""!==uniqueFilter.value;e.classList.toggle("hidden",!(t||l))}function updateUniquePill(e,t){uniqueFilter={label:"Unique Pill",option:e,value:t.toLowerCase(),key:"uniquePill"},console.log("Unique pill updated:",uniqueFilter),filterContent(),toggleFilterContainerVisibility()}function updateUniquePillUI(e,t){$("#uniquePill").remove(),appendPillToUI(e,t,"uniquePill")}function removeUniquePill(){uniqueFilter=null,$("#uniquePill").remove(),clearFilterPills(),console.log("Unique pill removed"),filterContent()}function appendPillToUI(e,t,l){var n=document.getElementById("filterPills"),i=document.createElement("div");i.id=l,i.classList.add("ntg-pill"),i.innerHTML=`
        <div class="btn btn-outline-dark rounded-pill me-2 mb-1 p-0">
            <input class="ntg-pill__checkbox" type="checkbox" name="pill${t}" id="pill${t}" checked>
            <label class="ntg-pill--filter__label py-1 px-2" for="pill${t}">${e}</label>
        </div>
    `,i.addEventListener("click",function(){showThenHideSpinner(),$("#uniquePill").remove(),uniqueFilter=null,$("#textInput").val(""),filterContent(),console.log("Unique Pill removed, here is the updated Name input Filter Array",uniqueFilter)}),n.appendChild(i)}function resetInputFields(){$("#textInput").val(""),$("#clearInput").hide(),Object.values(filters).forEach(e=>e.length=0)}function clearFilterPills(){document.getElementById("filterPills").innerHTML="",filterNameArray=[]}function clearAllFilters(e){e.preventDefault(),showThenHideSpinner(),resetInputFields(),clearFilterPills(),document.getElementById("active-filters").classList.add("hidden"),uniqueFilter=null,filterContent()}listViewButton&&listViewButton.addEventListener("click",()=>setViewMode("list")),gridViewButton&&gridViewButton.addEventListener("click",()=>setViewMode("grid")),$("#textInput").on("input",function(){var e=$(this).val(),t=e.replace(/\s/g,"");$("#clearInput").toggle(Boolean($(this).val())),3<=e.length?(showThenHideSpinner(),updateUniquePill(e,t),updateUniquePillUI(e,t)):($("#uniquePill").remove(),uniqueFilter=null),filterContent()}),document.getElementById("clearInput")&&document.getElementById("clearInput").addEventListener("click",function(){removeUniquePill(),resetInputFields(),filterContent()});